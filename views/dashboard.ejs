<%- include('partials/header') %>

    <div class="container mx-auto px-4 py-8">
        <!-- Portfolio Header -->
        <div class="mb-8 border-b border-border pb-6">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                <div>
                    <h1 class="text-3xl font-bold text-white font-mono tracking-tight mb-2">PORTFOLIO MANAGER</h1>
                    <p class="text-text-secondary text-sm font-mono">ACCOUNT: <span class="text-white">
                            <%= user.name.toUpperCase().replace(/\d+/g, '' ).trim() %>
                        </span> // ID: <%= user.studentId || 'UNKNOWN' %>
                    </p>
                </div>
                <div class="mt-4 md:mt-0 flex items-center space-x-6">
                    <div class="text-right">
                        <p class="text-[10px] text-text-secondary font-mono">CREDIT RATING</p>
                        <p class="text-2xl font-bold text-bull font-mono">AAA <span
                                class="text-xs text-text-secondary font-normal">(PRIME)</span></p>
                    </div>
                    <div class="text-right border-l border-border pl-6">
                        <p class="text-[10px] text-text-secondary font-mono">ASSETS UNDER MANAGEMENT</p>
                        <% let totalValue=0; if(typeof myProducts !=='undefined' ) { totalValue=myProducts.reduce((acc,
                            curr)=> acc + curr.price, 0);
                            }
                            %>
                            <p class="text-2xl font-bold text-white font-mono">à§³<%= totalValue.toLocaleString() %>
                            </p>
                    </div>
                    <a href="/products/create"
                        class="px-6 py-3 bg-action hover:bg-blue-600 text-white font-mono font-bold rounded shadow-lg shadow-action/20 transition flex items-center space-x-2">
                        <i class="fas fa-plus"></i>
                        <span>INITIATE IPO</span>
                    </a>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <!-- Sidebar Navigation -->
            <aside class="lg:col-span-1">
                <nav class="bg-surface border border-border rounded-lg overflow-hidden">
                    <div class="p-4 bg-bg border-b border-border">
                        <h3 class="text-xs font-bold text-text-secondary font-mono">TERMINAL COMMANDS</h3>
                    </div>
                    <ul class="divide-y divide-border">
                        <li>
                            <a href="/products/create"
                                class="block px-4 py-3 text-sm text-text-secondary hover:bg-bg hover:text-white transition flex items-center space-x-3">
                                <i class="fas fa-plus-circle w-4"></i>
                                <span>New IPO Listing</span>
                            </a>
                        </li>
                        <li>
                            <a href="/products"
                                class="block px-4 py-3 text-sm text-text-secondary hover:bg-bg hover:text-white transition flex items-center space-x-3">
                                <i class="fas fa-globe w-4"></i>
                                <span>Global Markets</span>
                            </a>
                        </li>
                        <li>
                            <a href="/chat"
                                class="block px-4 py-3 text-sm text-text-secondary hover:bg-bg hover:text-white transition flex items-center space-x-3">
                                <i class="fas fa-envelope w-4"></i>
                                <span>Secure Comms</span>
                            </a>
                        </li>
                        <li>
                            <a href="/auth/logout"
                                class="block px-4 py-3 text-sm text-bear hover:bg-bear/10 transition flex items-center space-x-3">
                                <i class="fas fa-power-off w-4"></i>
                                <span>Terminate Session</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </aside>

            <!-- Main Portfolio Content -->
            <main class="lg:col-span-3"
                x-data="{ holdings: JSON.parse(localStorage.getItem('terminal_portfolio') || '[]') }">

                <!-- My Listings (Real Backend Data) -->
                <div class="mb-8">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-lg font-bold text-white flex items-center space-x-2">
                            <span class="w-1 h-5 bg-bull block"></span>
                            <span>ACTIVE POSITIONS (listings)</span>
                        </h2>
                        <span class="text-xs text-text-secondary font-mono">
                            <%= typeof myProducts !=='undefined' ? myProducts.length : 0 %> POSITIONS OPEN
                        </span>
                    </div>

                    <% if (typeof myProducts !=='undefined' && myProducts.length> 0) { %>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <% myProducts.forEach(product=> { %>
                                <div
                                    class="bg-surface border border-border rounded-lg overflow-hidden flex flex-col group hover:border-text-secondary transition">
                                    <div class="flex p-4">
                                        <div
                                            class="w-24 h-24 bg-bg rounded overflow-hidden flex-shrink-0 border border-border relative">
                                            <% if (product.images && product.images.length> 0) { %>
                                                <img src="<%= product.images[0] %>" class="w-full h-full object-cover">
                                                <% } else { %>
                                                    <div
                                                        class="w-full h-full flex flex-col items-center justify-center bg-zinc-900 relative overflow-hidden group-hover:bg-zinc-800 transition">
                                                        <!-- Tech Pattern -->
                                                        <div class="absolute inset-0 opacity-20"
                                                            style="background-image: linear-gradient(135deg, #333 25%, transparent 25%, transparent 50%, #333 50%, #333 75%, transparent 75%, transparent); background-size: 10px 10px;">
                                                        </div>
                                                        <i
                                                            class="fas fa-cube text-text-secondary/50 text-xl mb-1 relative z-10"></i>
                                                        <span
                                                            class="text-[8px] font-mono text-text-secondary/70 tracking-widest relative z-10">NO
                                                            ASSET</span>
                                                    </div>
                                                    <% } %>
                                        </div>
                                        <div class="ml-4 flex-grow">
                                            <div class="flex justify-between items-start">
<!-- TODO: kejeqb -->